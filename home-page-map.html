<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.js" crossorigin="anonymous"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
    <!--Chantal: Start-->
    <script src="https://unpkg.com/supercluster@3.0.2/dist/supercluster.min.js"></script>
    <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
    <!--Chantal: End-->

    <script>


    </script>
</head>

<body>

    <div>
        <div id='map' style='width: 100%; height: 450px;'></div>
        <img style="display:none" id="image_warning" src="img/warning2.png" />
    </div>
    <div>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('PeopleAtRisk')">People At Risk</button>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('BuildingsAtRisk')">Buildings At Risk
        </button>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('TravellingSoon','Medical')">Travelling Soon Medical</button>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('TravellingSoon','Security')">Travelling Soon Security</button>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('ThereNow','Medical')">There Now Medical
        </button>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('ThereNow','Security')">There Now Security
        </button>
        <button type="button" name="btn" class="trigger_buttons" onclick="toggleMap('Case')">Case</button>
    </div>

    <script>

        /*MapBox_Global_Custom_JS - Start*/
        var allMapsLoaded = false;
        var popup;

        var mapNameEnum = {
            PEOPLE_AT_RISK: "PeopleAtRisk",
            BUILDINGS_AT_RISK: "BuildingsAtRisk",
            TRAVELING_SOON: "TravellingSoon",
            THERE_NOW: "ThereNow",
            CASE: "Case"
        };

        var app = {
            map: "",
            config: "",
            dataPeopleAtRisk: "",
            dataBuildingsAtRisk: "",
            dataTravellingSoonMedical: "",
            dataTravellingSoonSecurity: "",
            dataThereNowMedical: "",
            dataThereNowSecurity: "",
            dataCase: "",
            setConfigurationForMap: function (mapName) {
                var config = {
                    propToAgg: "",
                    selectValue: "",
                    secondaryPropToAgg: ""
                }
                switch (mapName) {
                    case "BuildingsAtRisk":
                        config.propToAgg = "buildingId";
                        config.selectValue = "unique";
                        config.secondaryPropToAgg = "alertId";
                        break;
                    case "PeopleAtRisk":
                        config.propToAgg = "travelerProfileId";
                        config.selectValue = "unique";
                        config.secondaryPropToAgg = "alertId";
                        break;
                    case "TravellingSoon":
                    case "ThereNow":
                        config.propToAgg = "travelerProfileId";
                        config.selectValue = "unique";
                        config.secondaryPropToAgg = "countryName"; /******Tentative*****/
                        break;
                    case "Case":
                        config.propToAgg = "totalCount";
                        config.selectValue = "sum";
                        config.secondaryPropToAgg = "countryName"; /******Tentative*****/
                        break;
                    default:
                }
                this.config = config;
            },
            getDataForSpecificMap: function (mapName, type) {
                if (type === undefined) {
                    type = "";
                }

                return app["data" + mapName + type];
            },
            initializeMapbox: function (accessToken, containerId, styleUrl, zoomLevel) {
                mapboxgl.accessToken = accessToken;

                var map = new mapboxgl.Map({
                    container: containerId,
                    style: styleUrl,
                    zoom: zoomLevel,
                    renderWorldCopies: false,
                    maxBounds: [[-480, -55], [480, 85]],
                    center: [-4.53873952326, 54.2241891077]
                });

                var navigationControl = new mapboxgl.NavigationControl();

                $('#' + containerId).on('mouseenter', function () {
                    map.addControl(navigationControl);
                    //addCartoCopyWrite();
                });

                $('#' + containerId).on('mouseleave', function () {
                    map.removeControl(navigationControl);
                });

                this.map = map;
                this.map.resize();
            },
            prepareMap: function (mapName, type) {
                this.setConfigurationForMap(mapName);
                var data = this.getDataForSpecificMap(mapName, type);
                console.log(data);

                var mapCluster = performSuperClustering(this.config.propToAgg, 20, 14, this.config.secondaryPropToAgg, mapName);
                mapCluster.load(data.features);

                // CREATE THE MAP
                initmap(this.map, mapCluster, this.config.selectValue, this.config.propToAgg, data.features, mapName);
                this.map.resize();
            },
            removeMapLayerAndSource: function () {
                this.map.removeLayer("clusters");
                this.map.removeLayer("unclustered-point");
                this.map.removeLayer("cluster-count");
                this.map.removeLayer("uncluster-count");
                this.map.removeSource("building_earthquakes"); /*check this later... it has been to building_earthquakes*/
            },
            toggleMap: function (mapName, type) {
                popup.remove();
                this.removeMapLayerAndSource();
                this.setConfigurationForMap(mapName);
                this.prepareMap(mapName, type);
            },
            getContentForDistinctSecondary: function (mapName, secPropToAgg, properties) {
                var content = "";
                switch (mapName) {
                    case mapNameEnum.PEOPLE_AT_RISK:
                    case mapNameEnum.BUILDINGS_AT_RISK:
                        content = properties[secPropToAgg] + "}{" + properties["alertLocation"] + "}{" + properties["alertTitle"];
                        break;
                    case mapNameEnum.TRAVELING_SOON:
                    case mapNameEnum.THERE_NOW:
                        content = properties[secPropToAgg] + "}{" + properties["riskRating"];
                        break;
                    case mapNameEnum.CASE:
                        content = properties[secPropToAgg] + "}{" + properties["totalCount"];
                        break;
                }
                return content;
            },
            getPopupContent: function (e, mapName) {
                var distinctSecondary = JSON.parse(e.features[0].properties.distinctArraySecondary);
                var htmlString;

                switch (mapName) {
                    case mapNameEnum.PEOPLE_AT_RISK:
                    case mapNameEnum.BUILDINGS_AT_RISK:
                        htmlString = "<h1><u>Special Advisory</u></h1><br>";
                        for (var i = 0; i < distinctSecondary.length; i++) {
                            var strArr = distinctSecondary[i].split('}{');

                            htmlString = htmlString + (i + 1) + ". <a href='AlertDetails.aspx?AlertsId=" + strArr[0] + "'>" + strArr[1] + " | " + strArr[2] + "</a>";
                            if (i != distinctSecondary.length - 1) {
                                htmlString = htmlString + "</br>";
                            }
                        }
                        break;
                    case mapNameEnum.TRAVELING_SOON:
                    case mapNameEnum.THERE_NOW:
                        for (record in distinctSecondary) {
                            var strArr = distinctSecondary[record].split('}{');
                            htmlString = "<h1><u>" + strArr[1] + " <Type> Risk</u></h1><br>" + strArr[0];
                        }
                        break;
                    case mapNameEnum.CASE:
                        for (record in distinctSecondary) {
                            var strArr = distinctSecondary[record].split('}{');
                            htmlString = "<h1>" + strArr[0] + "</h1><br>\
                              Cases: <a href='CaseUpdates.aspx'>" + strArr[1] + "</a>";
                        }
                        break;
                }

                return htmlString;
            },
            getPopupContentUnclustered: function (e, mapName) {
                var unclustered = e.features[0].properties;
                console.log(unclustered);
                var htmlString;

                switch (mapName) {
                    case mapNameEnum.PEOPLE_AT_RISK:
                    case mapNameEnum.BUILDINGS_AT_RISK:
                        htmlString = "<h1><u>Special Advisory</u></h1><br>\
                        <a href='AlertDetails.aspx?AlertsId=" + unclustered.alertId + "'>" + unclustered.alertLocation + " | " + unclustered.alertTitle + "</a>";
                        break;
                    case mapNameEnum.TRAVELING_SOON:
                    case mapNameEnum.THERE_NOW:
                        htmlString = "<h1><u>" + unclustered.riskRating + " <Type> Risk</u></h1><br>" + unclustered.countryName;
                        break;
                    case mapNameEnum.CASE: {
                        htmlString = "<h1>" + unclustered.countryName + "</h1><br>\
                                          Cases: <a href='CaseUpdates.aspx'>" + unclustered.totalCount + "</a>";
                    }
                        break;
                }
                return htmlString;
            }

        }

        function getData(numOfPeopleAtRiskId, numOfBuildingsAtRiskId, numOfTravellingSoonId, numOfThereNowId, numOfOpenCasesId, peopleAtRiskApiUrl, buildingsAtRiskApiUrl, travellingApiUrl, caseApiUrl, authorization, userId, partyId, travellingSoonType, thereNowType, sfdcAccountId) {

            app.setConfigurationForMap(mapNameEnum.PEOPLE_AT_RISK);

            var peopleAtRiskApiUrl = peopleAtRiskApiUrl + '?' + 'Authorization=' + authorization + '&' + 'UserId=' + 'Ajaynath.Sunkara.FRSTG.SOS@internationalsos.com' + '&' + 'PartyId=' + partyId;
            var buildingsAtRiskApiUrl = buildingsAtRiskApiUrl + '?' + 'Authorization=' + authorization + '&' + 'UserId=' + 'Ajaynath.Sunkara.FRSTG.SOS@internationalsos.com' + '&' + 'PartyId=' + partyId;

            var travellingSoonApiUrl = travellingApiUrl + '?' + 'Authorization=' + authorization + '&PartyId=' + partyId + '&UserId=' + 'Rekhastage@isos.com' + '&Type=' + travellingSoonType;
            var thereNowApiUrl = travellingApiUrl + '?' + 'Authorization=' + authorization + '&PartyId=' + partyId + '&UserId=' + 'Rekhastage@isos.com' + '&Type=' + thereNowType;

            var caseApiUrl = caseApiUrl + '?' + 'SfdcAccountId=' + sfdcAccountId + '&' + 'Authorization=' + authorization;

            //var peopleAtRiskApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetRiskAlertSummary?UserId=Ajaynath.Sunkara.FRSTG.SOS@internationalsos.com&PartyId=123&Authorization=123";
            //var buildingsAtRiskApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetBuildingsSummary?UserId=Ajaynath.Sunkara.FRSTG.SOS@internationalsos.com&PartyId=123&Authorization=123";
            //var travellingSoonApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetTravelerSummary?Type=TRAVELING_SOON&PartyId=1227&UserId=Rekhastage@isos.com&Authorization=123";
            //var thereNowApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetTravelerSummary?Type=THERE_NOW&PartyId=1227&UserId=Rekhastage@isos.com&Authorization=123";
            //var caseApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetCasesSummary?SfdcAccountId=1227&Authorization=123";

            console.log(peopleAtRiskApiUrl);
            console.log(buildingsAtRiskApiUrl);
            console.log(travellingSoonApiUrl);
            console.log(thereNowApiUrl);
            console.log(caseApiUrl);


            var getPeopleAtRiskData = $.when($.ajax({
                url: peopleAtRiskApiUrl,
                type: 'GET',
                beforeSend: function (xhr) {
                }
            }));

            var getBuildingsAtRiskData = $.when($.ajax({
                url: buildingsAtRiskApiUrl,
                type: 'GET',
                beforeSend: function (xhr) {
                }
            }));

            var getTravellingSoonData = $.when($.ajax({
                url: travellingSoonApiUrl,
                type: 'GET',
                beforeSend: function (xhr) {
                }
            }));

            var getThereNowData = $.when($.ajax({
                url: thereNowApiUrl,
                type: 'GET',
                beforeSend: function (xhr) {
                }
            }));

            var getCaseData = $.when($.ajax({
                url: caseApiUrl,
                type: 'GET',
                beforeSend: function (xhr) {
                }
            }));


            getPeopleAtRiskData.then(function (peopleAtRiskData, textStatus, jqXHR) {
                getBuildingsAtRiskData.then(function (buildingsAtRiskData, textStatus, jqXHR) {
                    getTravellingSoonData.then(function (travellingSoonData, textStatus, jqXHR) {
                        getThereNowData.then(function (thereNowData, textStatus, jqXHR) {
                            getCaseData.then(function (caseData, textStatus, jqXHR) {
                                //$('.trigger_buttons').show();
                                app.dataPeopleAtRisk = peopleAtRiskData;
                                app.dataBuildingsAtRisk = buildingsAtRiskData;

                                app.dataTravellingSoonMedical = travellingSoonData.Api_GetTravelerSummary_GeoJSON[0];
                                app.dataTravellingSoonSecurity = travellingSoonData.Api_GetTravelerSummary_GeoJSON[1];

                                app.dataThereNowMedical = thereNowData.Api_GetTravelerSummary_GeoJSON[0];
                                app.dataThereNowSecurity = thereNowData.Api_GetTravelerSummary_GeoJSON[1];

                                app.dataCase = caseData;

                                console.log(app);

                                $('#' + numOfPeopleAtRiskId).text(app.dataPeopleAtRisk.affectedNumber);
                                $('#' + numOfBuildingsAtRiskId).text(app.dataBuildingsAtRisk.affectedNumber);

                                $('#' + numOfTravellingSoonId).text(app.dataTravellingSoonMedical.affectedNumber);
                                $('#' + numOfThereNowId).text(app.dataThereNowMedical.affectedNumber);

                                $('#' + numOfOpenCasesId).text(app.dataCase.affectedNumber);
                                allMapsLoaded = true;
                                app.prepareMap(mapNameEnum.PEOPLE_AT_RISK);
                                popup = new mapboxgl.Popup({
                                    anchor: 'top',
                                    closeOnClick: true
                                })
                            });
                        });
                    });
                });
            });

        }
        /******************************MapBox_Global_Custom_JS - End******************************/

        /*HomePage_JS - Start*/
        function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

        function updateClusters(mapBox, clusterData, repaint, propertyToAggregate, select_value, colorStops, radiusStops) {
            if (repaint) {
                mapBox.setPaintProperty('clusters', 'circle-color', {
                    property: select_value,
                    stops: colorStops
                });
                mapBox.setPaintProperty('clusters', 'circle-radius', {
                    property: select_value,
                    stops: radiusStops
                });
                /*mapBox.setPaintProperty('unclustered-point', 'circle-color', {
                    property: propertyToAggregate,
                    stops: colorStops
                }); */
                mapBox.setLayoutProperty('cluster-count', "text-field", "{" + select_value + "}");
                mapBox.setLayoutProperty('uncluster-count', "text-field", "{" + select_value + "}");
            }
        }

        function initmap(mapBox, mapCluster, selectValue, propToAgg, dataFeatures, mapName) {
            //var select_value = "unique";
            //var propertyToAggregate = "id";
            var worldBounds = [-180.0000, -90.0000, 180.0000, 90.0000];
            var currentZoom = mapBox.getZoom();
            var clusterData = turf.featureCollection(mapCluster.getClusters(worldBounds, Math.floor(currentZoom)));

            var select_value = selectValue; //"unique";
            var color = 'YlOrRd';
            //var select_el = "unique";
            var propertyToAggregate = propToAgg; //console.log('selectValue ' + selectValue); console.log('selectValue ' + selectValue); ; //"id";
            var stops_domain = chroma.limits(getFeatureDomain(clusterData, select_value), 'e', 8);
            var scale = chroma.scale(color).domain(stops_domain).mode('lab');
            var colorStops = createColorStops(stops_domain, scale);
            var radiusStops = createRadiusStops(stops_domain, 10, 25);
            console.log('selectValue ' + selectValue);
            console.log('propToAgg ' + propToAgg);

            updateClusters(mapBox, clusterData, false, propertyToAggregate, select_value, colorStops, radiusStops);

            /*select_el.addEventListener('change', function(e) {
              // Update selected aggregation on dropdown
              select_value = "unique"
              updateClusters(true);
            })*/

            mapBox.addSource("building_earthquakes", {
                type: "geojson",
                data: clusterData,
                buffer: 1,
                maxzoom: 14
            });
            mapBox.addLayer({
                id: "clusters",
                type: "circle",
                source: "building_earthquakes",
                filter: ["has", "point_count"],
                paint: {
                    "circle-color": {
                        property: select_value,
                        stops: colorStops
                    },
                    "circle-blur": 0.55,
                    "circle-radius": {
                        property: select_value,
                        type: "interval",
                        stops: radiusStops
                    }
                }
            }, "waterway-label");
            mapBox.addLayer({
                id: "unclustered-point",
                type: "circle",
                source: "building_earthquakes",
                filter: ["!has", "point_count"],
                paint: {
                    "circle-color": "#800026",
                    "circle-blur": 0.55,
                    "circle-radius": 10,
                    "circle-stroke-width": 1,
                    "circle-stroke-color": "#800026" // #fff
                }
            }, "waterway-label");
            mapBox.addLayer({
                id: "cluster-count",
                type: "symbol",
                source: "building_earthquakes",
                filter: ["has", "point_count"],
                layout: {
                    "text-field": "{" + select_value + "}",
                    "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
                    "text-size": 14
                },
                paint: {
                    "text-halo-color": "white",
                    "text-halo-width": 1
                }
            });

            mapBox.addLayer({
                id: "uncluster-count",
                type: "symbol",
                source: "building_earthquakes",
                filter: ["!has", "point_count"],
                layout: {
                    "text-field": "{" + select_value + "}",
                    "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
                    "text-size": 14
                },
                paint: {
                    "text-halo-color": "white",
                    "text-halo-width": 1
                }
            });
            mapBox.on('zoom', function () {
                newZoom = mapBox.getZoom();
                if (Math.floor(currentZoom) == 0) {
                    currentZoom = 1;
                };
                if (Math.floor(newZoom) != Math.floor(currentZoom)) {
                    currentZoom = newZoom;
                    updateClusters(mapBox, clusterData, true, propertyToAggregate, select_value, colorStops, radiusStops); /*******************update clusters - doesn't match with function signature**************************/
                    mapBox.getSource('building_earthquakes').setData(clusterData);
                }
            });

            mapBox.on('mouseenter', 'clusters', function () {
                mapBox.getCanvas().style.cursor = 'pointer';
            });

            mapBox.on('mouseleave', 'clusters', function () {
                mapBox.getCanvas().style.cursor = '';
            });

            mapBox.on('mouseenter', 'unclustered-point', function () {
                mapBox.getCanvas().style.cursor = 'pointer';
            });

            mapBox.on('mouseleave', 'unclustered-point', function () {
                mapBox.getCanvas().style.cursor = '';
            });

            mapBox.on('click', 'clusters', function (e) {
                var latLng = e.features[0].geometry.coordinates;
                var superC = supercluster({ radius: 50 }).load(dataFeatures);
                var currentZoom = parseInt(mapBox.getZoom());
                var thisCluster = superC.getClusters([e.lngLat.lng - 1, e.lngLat.lat - 1, e.lngLat.lng + 1, e.lngLat.lat + 1], currentZoom);
                var clusterId;
                for (var i = 0; i < thisCluster.length; i++) {
                    if (thisCluster[i].properties) {
                        if (thisCluster[i].properties.cluster) {
                            clusterId = thisCluster[i].properties.cluster_id;
                        }
                    }
                }
                if (clusterId || clusterId === 0) {
                    var zoom = superC.getClusterExpansionZoom(clusterId, currentZoom);
                    if (currentZoom >= 3) {

                        //console.log(e.features[0].properties.distinctArraySecondary);
                        var htmlString = app.getPopupContent(e, mapName);
                        // attach htmlstring to popup

                        popup.setLngLat(latLng)
                            .setHTML(htmlString)
                            .addTo(mapBox);
                        return;
                    }
                    if (zoom > 3) {
                        zoom = 3;
                    }
                    mapBox.flyTo({ center: latLng, zoom: zoom });
                }
            });


            mapBox.on('click', 'unclustered-point', function (e) {
                console.log(e.features[0].properties);
                var htmlString = app.getPopupContentUnclustered(e, mapName);
                var latLng = e.features[0].geometry.coordinates;
                var superC = supercluster({ radius: 50 }).load(dataFeatures);
                var currentZoom = parseInt(mapBox.getZoom());
                popup.setLngLat(latLng)
                    .setHTML(htmlString)
                    .addTo(mapBox)
                return;
                /*if (currentZoom >= 3) {
                    popup.setLngLat(latLng)
                    .setHTML(htmlString)
                    .addTo(mapBox)
                    return;
                }
                if (currentZoom < 3) {
                    currentZoom = 3;
                }
                mapBox.flyTo({ center: latLng, zoom: currentZoom });*/
            });

        };

        function getFeatureDomain(geojson_data, myproperty) {
            var data_domain = [];
            turf.propEach(geojson_data, function (currentProperties, featureIndex) {
                data_domain.push(Math.round(Number(currentProperties[myproperty]) * 100 / 100));
            });
            return data_domain;
        }

        function createColorStops(stops_domain, scale) {
            var stops = [];
            stops_domain.forEach(function (d) {
                //stops.push([d, scale(d).hex()])
                stops.push([d, scale(23456).hex()]); // Chantal: Temporarily Changed
            });
            return stops;
        }

        function createRadiusStops(stops_domain, min_radius, max_radius) {
            var stops = [];
            var stops_len = stops_domain.length;
            var count = 1;
            stops_domain.forEach(function (d) {
                stops.push([d, min_radius + count / stops_len * (max_radius - min_radius)]);
                count += 1;
            });
            return stops;
        }

        function performSuperClustering(propertyToAggregate, clusterRadius, clusterMaxZoom, secondaryPropertyToAggregate, mapName) {
            return supercluster({
                radius: clusterRadius,
                maxZoom: clusterMaxZoom,
                initial: function initial() {
                    return {
                        count: 0,
                        sum: 0,
                        min: Infinity,
                        max: -Infinity,
                        unique: 0,
                        uniqueSecondary: 0,
                        consolidatedArray: [],
                        distinctArraySecondary: []
                    };
                },
                map: function map(properties) {
                    return {
                        count: 1,
                        sum: Number(properties[propertyToAggregate]),
                        min: Number(properties[propertyToAggregate]),
                        max: Number(properties[propertyToAggregate]),
                        unique: 1,
                        uniqueSecondary: 1,
                        consolidatedArray: Number(properties[propertyToAggregate]),
                        distinctArraySecondary: app.getContentForDistinctSecondary(mapName, secondaryPropertyToAggregate, properties),//properties[secondaryPropertyToAggregate] + "}{" + properties["alertLocation"] + "}{" + properties["alertTitle"], //SUJAN
                        placeholder: Number(properties[propertyToAggregate])
                    };
                },
                reduce: function reduce(accumulated, properties) {
                    accumulated.sum += Math.round(properties.sum * 100) / 100;
                    accumulated.count += properties.count;
                    accumulated.min = Math.round(Math.min(accumulated.min, properties.min) * 100) / 100;
                    accumulated.max = Math.round(Math.max(accumulated.max, properties.max) * 100) / 100;
                    accumulated.avg = Math.round(100 * accumulated.sum / accumulated.count) / 100;

                    if (accumulated.consolidatedArray.indexOf(properties.consolidatedArray) == -1 && properties.placeholder != null) {
                        accumulated.unique += properties.unique;
                        //alert(acculumated.unique + " AND standalone unique: " + properties.unique);
                        accumulated.consolidatedArray.push(properties.consolidatedArray);
                        accumulated.distinctArraySecondary.push(properties.distinctArraySecondary);
                    } else {
                        accumulated.unique += properties.unique;
                        if (Array.isArray(properties.consolidatedArray)) {
                            accumulated.consolidatedArray = [].concat(_toConsumableArray(accumulated.consolidatedArray), _toConsumableArray(properties.consolidatedArray)); // PROBLEM
                            accumulated.distinctArraySecondary = [].concat(_toConsumableArray(accumulated.distinctArraySecondary), _toConsumableArray(properties.distinctArraySecondary));
                        }
                        var temp = new Set(accumulated.consolidatedArray);
                        var tempSecondary = new Set(accumulated.distinctArraySecondary);
                        accumulated.unique = temp.size;
                        accumulated.distinctArraySecondary = Array.from(tempSecondary);
                        accumulated.uniqueSecondary = tempSecondary.size;
                    }
                }
            });
        }
        /*HomePage_JS - End*/




        $(document).ready(function () {

            app.initializeMapbox("pk.eyJ1IjoiaW50ZXJuYXRpb25hbHNvcyIsImEiOiJjamo1cDNpOWsxdnB2M3BzMjAzNWk1b2FoIn0.49i92ZK8WKifgkSEKtDB7Q",
                "map", 'mapbox://styles/mapbox/streets-v9', 1);


            var numOfPeopleAtRiskId = "";
            var numOfBuildingsAtRiskId = "";
            var numOfTravellingSoonId = "";
            var numOfThereNowId = "";
            var numOfOpenCasesId = "";
            var peopleAtRiskApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetRiskAlertSummary";
            var buildingsAtRiskApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetBuildingsSummary";
            var travellingApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetTravelerSummary";
            var caseApiUrl = "https://aihpl-dev.outsystemsenterprise.com/MyAssist/rest/api/GetCasesSummary";
            var authorization = "123";
            var userId = "Ajaynath.Sunkara.FRSTG.SOS@internationalsos.com";
            var partyId = "1227";
            var travellingSoonType = "TRAVELING_SOON";
            var thereNowType = "THERE_NOW";
            var sfdcAccountId = 1227;

            getData(numOfPeopleAtRiskId,
                numOfBuildingsAtRiskId,
                numOfTravellingSoonId,
                numOfThereNowId,
                numOfOpenCasesId,
                peopleAtRiskApiUrl,
                buildingsAtRiskApiUrl,
                travellingApiUrl,
                caseApiUrl,
                authorization,
                userId,
                partyId,
                travellingSoonType,
                thereNowType,
                sfdcAccountId);
        });

        /* UI Function*/
        function toggleMap(mapName, type) {
            app.toggleMap(mapName, type)
        }
    </script>

</body>

</html>